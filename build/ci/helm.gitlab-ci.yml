lint:helm:monoskope:
  stage: test
  image: registry.gitlab.figo.systems/platform/helm-builder:1.12.1
  only:
    - main
    - develop
    - merge_requests
    - tags
  script:
    - make helm-lint-monoskope
  needs: []

lint:helm:gateway:
  stage: test
  image: registry.gitlab.figo.systems/platform/helm-builder:1.12.1
  only:
    - main
    - develop
    - merge_requests
    - tags
  script:
    - make helm-lint-gateway
  needs: []

deliver:chart:gateway:
  stage: deliver
  except:
    refs:
      - tags
  image: registry.gitlab.figo.systems/platform/helm-builder:1.7.0
  script:
    - VERSION=$(sh ./build/ci/configure_versions.sh)
    - build-chart --chart-dir ./build/package/helm/gateway --promote-version $VERSION
  dependencies:
    - lint:helm:gateway

deliver:chart:monoskope:
  stage: deliver
  only:
    - tags
  image: registry.gitlab.figo.systems/platform/helm-builder:1.7.0
  script:
    - VERSION=$(sh ./build/ci/configure_versions.sh)
    - build-chart --chart-dir ./build/package/helm/monoskope --promote-version $VERSION
  dependencies:
    - lint:helm:monoskope
