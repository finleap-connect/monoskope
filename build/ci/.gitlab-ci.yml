stages:
  - test
  - deliver

test:golang:
  stage: test
  image: gitlab.figo.systems/platform/dependency_proxy/containers/golang:1.15-buster
  services:
    - docker:18-dind
  only:
    - main
    - merge_requests
    - tags
  script:
    - make go-prepare
    - make go-vet
    - make go-lint
    - make go-test

deliver:chart:
  stage: deliver
  only:
    - tag
  image: registry.gitlab.figo.systems/platform/helm-builder:1.7.0
  script:
    - VERSION=$(sh ./build/ci/configure_versions.sh)
    - build-chart --chart-dir ./build/package/helm --promote-version $VERSION
