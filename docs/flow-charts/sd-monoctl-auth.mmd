sequenceDiagram
    participant U as User
    participant M as monoctl
    participant G as Gateway
    participant D as Dex
    participant I as Identity Provider
    participant E as ETCD
    U-->>+M: monoctl auth login
    M-->>+G: calls GetAuthInformation
    G-->>-M: returns AuthInformation
    M-->>M: opens browser
    M-->>D: navigate browser to AuthCodeURL from AuthInformation
    D-->>+I: redirect to IdP
    I-->>I: determines userâ€™s identity
    I-->>-M: redirect with auth_code
    M-->>+G: calls ExchangeAuthCode
    G-->>+D: exchange auth_code
    D-->>-G: receive id_token
    G-->>E: store user session
    Note right of G: Session contains refresh_token
    G-->>-M: returns bearer token
    M-->>-U: Output login success
